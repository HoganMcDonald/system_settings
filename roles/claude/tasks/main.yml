- name: Install Claude Code CLI
  npm:
    name: "@anthropic-ai/claude-code"
    global: yes

- name: Install OpenCode CLI
  npm:
    name: "opencode-ai"
    global: yes

- name: Check if Claude config exists
  stat: path="{{ claude_config_dir }}"
  register: claude_config_stat

- name: Back up Claude config
  command: "mv {{ claude_config_dir }} {{ claude_config_dir }}_old"
  args:
    creates: "{{ claude_config_dir }}_old"
  when: claude_config_stat.stat.exists

- name: Check if OpenCode config exists
  stat: path="{{ opencode_config_dir }}"
  register: opencode_config_stat

- name: Back up OpenCode config
  command: "mv {{ opencode_config_dir }} {{ opencode_config_dir }}_old"
  args:
    creates: "{{ opencode_config_dir }}_old"
  when: opencode_config_stat.stat.exists

- name: Symlink Claude config
  file:
    src: "{{ dotfiles_home }}/roles/claude/files/claude"
    dest: "{{ claude_config_dir }}"
    state: link
    force: yes

- name: Symlink OpenCode config
  file:
    src: "{{ dotfiles_home }}/roles/claude/files/opencode"
    dest: "{{ opencode_config_dir }}"
    state: link
    force: yes
