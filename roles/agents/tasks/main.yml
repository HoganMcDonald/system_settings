- name: Install Claude Code CLI
  homebrew_cask:
    name: claude-code

- name: Install Codex CLI
  npm:
    name: "@openai/codex"
    global: yes

- name: Check if Claude config exists
  stat: path="{{ claude_config_dir }}"
  register: claude_config_stat

- name: Back up Claude config
  command: "mv {{ claude_config_dir }} {{ claude_config_dir }}_old"
  args:
    creates: "{{ claude_config_dir }}_old"
  when: claude_config_stat.stat.exists

- name: Symlink Claude config
  file:
    src: "{{ dotfiles_home }}/roles/agents/files/claude"
    dest: "{{ claude_config_dir }}"
    state: link
    force: yes

- name: Check if Codex config exists
  stat: path="{{ codex_config_dir }}"
  register: codex_config_stat

- name: Back up Codex config
  command: "mv {{ codex_config_dir }} {{ codex_config_dir }}_old"
  args:
    creates: "{{ codex_config_dir }}_old"
  when: codex_config_stat.stat.exists

- name: Symlink Codex config
  file:
    src: "{{ dotfiles_home }}/roles/agents/files/codex"
    dest: "{{ codex_config_dir }}"
    state: link
    force: yes
